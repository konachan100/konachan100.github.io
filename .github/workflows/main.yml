on:
  workflow_dispatch:
  schedule:
    - cron: "*/5 * * * *"

jobs:
  update_site:
    runs-on: ubuntu-latest
    steps:
      - name: config email
        run: git config --global user.email "isn_cg@163.com"
      - name: config name
        run: git config --global user.name "isncg"
      - name: Clone konachan100.github.io
        uses: sudosubin/git-clone-action@v1.0.1
      - name: Clone konachan100-src
        # You may pin to the exact commit or the version.
        # uses: sudosubin/git-clone-action@8a93ce24d47782e30077508cccacf8a05a891bae
        uses: sudosubin/git-clone-action@v1.0.1
        with:
          # Repository owner and name. Ex: sudosubin/git-clone-action
          repository: konachan100/konachan100-src # optional, default is ${{ github.repository }}
          # Git host platform. Ex: github, gitlab, bitbucket, gitee, or else (git.suckless.org, ...)
          platform: github # optional, default is github
          # Git branch or tag to checkout.
          #ref: # optional
          # Relative path from current directory, where to clone.
          path: src # optional
      - name: pwd
        run: pwd
        
      - name: create count file
        run: echo $GITHUB_RUN_NUMBER > src/buildcount.txt
      - name: show contents
        run: tree .
      - name: update site
        run: bash update_ci.sh
      - name: GitHub Push
        # You may pin to the exact commit or the version.
        # uses: ad-m/github-push-action@40bf560936a8022e68a3c00e7d2abefaf01305a6
        uses: ad-m/github-push-action@v0.6.0
        with:
          # Token for the repo. Can be passed in using $\{{ secrets.GITHUB_TOKEN }}
          github_token: ${{ secrets.GITHUB_TOKEN }}
